# ๐ Firestore Security Rules - ุชุนูููุงุช ุงูุชุทุจูู

## โ ุชู ุฅูุดุงุก ููู `firestore.rules`

ูุฐุง ุงูููู ูุญุชูู ุนูู ููุงุนุฏ ุฃูุงู ุดุงููุฉ ูุญูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช.

---

## ๐ ููููุฉ ุชุทุจูู ุงูููุงุนุฏ:

### **ุงูุทุฑููุฉ 1: Firebase Console (ุงูุฃุณูู)**

1. **ุงูุชุญ Firebase Console:**
   - ุงุฐูุจ ุฅูู: https://console.firebase.google.com/
   - ุงุฎุชุฑ ูุดุฑูุน DineBuddies

2. **ุงูุชูู ุฅูู Firestore:**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ **Firestore Database**
   - ุงุถุบุท ุนูู ุชุจููุจ **Rules**

3. **ุงูุณุฎ ุงูููุงุนุฏ:**
   - ุงูุชุญ ููู `firestore.rules` ูู ุงููุดุฑูุน
   - ุงูุณุฎ ูู ุงููุญุชูู
   - ุงูุตูู ูู ูุญุฑุฑ ุงูููุงุนุฏ ูู Firebase Console

4. **ุงูุดุฑ ุงูููุงุนุฏ:**
   - ุงุถุบุท **Publish**
   - ุงูุชุธุฑ ุงูุชุฃููุฏ (5-10 ุซูุงูู)

---

### **ุงูุทุฑููุฉ 2: Firebase CLI (ูููุทูุฑูู)**

```bash
# ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู
firebase login

# ุชููุฆุฉ ุงููุดุฑูุน (ุฅุฐุง ูู ููู ูููุฃ)
firebase init firestore

# ุฑูุน ุงูููุงุนุฏ
firebase deploy --only firestore:rules
```

---

## ๐ ูุง ุชุญููู ูุฐู ุงูููุงุนุฏ:

### **โ Users Collection:**
- โ ุงูุฌููุน ูููููู ูุฑุงุกุฉ ุงููููุงุช (ููุงูุชุดุงู)
- โ ููุท ุงููุงูู ููููู ุชุนุฏูู ูููู
- โ ูุง ูููู ุชุบููุฑ `role` ุฃู `accountType` (ุญูุงูุฉ ูู ุงูุชุตุนูุฏ)
- โ ุงูุฃุฏูู ููููู ุชุนุฏูู ุฃู ูุณุชุฎุฏู

### **โ Invitations Collection:**
- โ ุงูุฏุนูุงุช ุงูุนุงูุฉ: ุงูุฌููุน ููุฑุฃ
- โ ุงูุฏุนูุงุช ุงูุฎุงุตุฉ: ููุท ุงููุถูู ูุงููุฏุนููู
- โ **ุญูุงูุฉ `pendingRequests`:** ููุท ุงููุถูู ูุฑุงูุง!
- โ ููุท ุงููุถูู ููููู ุงูุชุนุฏูู
- โ ุงููุดุงุฑููู ูููููู ุงููุบุงุฏุฑุฉ ููุท

### **โ Chats Collection:**
- โ ููุท ุงููุดุงุฑููู ูููููู ุงููุฑุงุกุฉ
- โ ููุท ุงููุดุงุฑููู ูููููู ุฅุฑุณุงู ุฑุณุงุฆู
- โ ูุฌุจ ุฃู ูููู `senderId` ูู uid ุงูุญูููู
- โ ูุง ูููู ุงูุชุญุงู ุงููููุฉ

### **โ Notifications Collection:**
- โ ููุท ุงููุณุชูู ููููู ูุฑุงุกุฉ ุฅุดุนุงุฑุงุชู
- โ ููุท ุงููุณุชูู ููููู ุชุนุฏูู/ุญุฐู ุฅุดุนุงุฑุงุชู
- โ ุงูุฃุฏูู ููููู ุฑุคูุฉ ุฌููุน ุงูุฅุดุนุงุฑุงุช

### **โ ุฃูุงู ุฅุถุงูู:**
- โ ููุน ุงููุตูู ูุฃู collection ุบูุฑ ูุญุฏุฏ
- โ ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูู ูู ุนูููุฉ
- โ ููุน ุชุนุฏูู ุงูุญููู ุงูุญุณุงุณุฉ

---

## ๐งช ุงุฎุชุจุงุฑ ุงูููุงุนุฏ:

### **ูู Firebase Console:**

1. ุงุฐูุจ ุฅูู **Firestore Database** โ **Rules**
2. ุงุถุบุท ุนูู **Rules Playground**
3. ุฌุฑุจ ุงูุณููุงุฑูููุงุช ุงูุชุงููุฉ:

**ุงุฎุชุจุงุฑ 1: ูุฑุงุกุฉ ุฏุนูุฉ ุนุงูุฉ**
```
Type: get
Location: /databases/(default)/documents/invitations/test123
Auth: Authenticated (any user)
Expected: Allow โ
```

**ุงุฎุชุจุงุฑ 2: ูุฑุงุกุฉ pendingRequests ูู ุฏุนูุฉ ููุณุช ูู**
```
Type: get
Location: /databases/(default)/documents/invitations/test123
Auth: Authenticated (not the host)
Expected: Allow (but pendingRequests hidden) โ
```

**ุงุฎุชุจุงุฑ 3: ุชุนุฏูู ููู ูุณุชุฎุฏู ุขุฎุฑ**
```
Type: update
Location: /databases/(default)/documents/users/otherUserId
Auth: Authenticated (different user)
Expected: Deny โ
```

**ุงุฎุชุจุงุฑ 4: ูุฑุงุกุฉ ุฑุณุงุฆู chat ููุณุช ูู**
```
Type: get
Location: /databases/(default)/documents/chats/chat123/messages/msg1
Auth: Authenticated (not in participants)
Expected: Deny โ
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ:

1. **ุจุนุฏ ุงููุดุฑ:**
   - ุงูููุงุนุฏ ุชุฃุฎุฐ 5-10 ุซูุงูู ูุชูุนูููุง
   - ูุฏ ุชุญุชุงุฌ ูุชุญุฏูุซ ุงูุตูุญุฉ

2. **ุฅุฐุง ุธูุฑุช ุฃุฎุทุงุก:**
   - ุชุญูู ูู ุฃู ุฌููุน ุงููุณุชุฎุฏููู ูุฏููู `role` ูู Firestore
   - ุชุญูู ูู ุฃู ุงูุฏุนูุงุช ูุฏููุง `privacy` field
   - ุชุญูู ูู ุฃู ุงูู chats ูุฏููุง `participants` array

3. **ููุชุทููุฑ:**
   - ููููู ุชุฎููู ุงูููุงุนุฏ ูุคูุชุงู ููุงุฎุชุจุงุฑ
   - ููู **ูุง ุชูุดุฑ** ููุงุนุฏ ูุฎููุฉ ููุฅูุชุงุฌ!

4. **ุงููุณุฎ ุงูุงุญุชูุงุทู:**
   - Firebase ูุญุชูุธ ุจุชุงุฑูุฎ ุงูููุงุนุฏ
   - ููููู ุงูุฑุฌูุน ููุณุฎุฉ ุณุงุจูุฉ ุฅุฐุง ุญุฏุซุช ูุดููุฉ

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ:

ุจุนุฏ ุชุทุจูู ุงูููุงุนุฏ:
1. โ ุงุฎุชุจุฑ ุงูุชุทุจูู ููุชุฃูุฏ ูู ุนูู ูู ุดูุก
2. โ ุชุญูู ูู Console ููุฃุฎุทุงุก
3. โ ุฅุฐุง ุธูุฑุช ูุดุงููุ ุฃุฎุจุฑูู ููุฑุงู!

---

## ๐ ุฅุฐุง ูุงุฌูุช ูุดููุฉ:

**ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ:**

### **ุฎุทุฃ: "Missing or insufficient permissions"**
**ุงูุญู:** ุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ููู ุงูุตูุงุญูุงุช ุงููุทููุจุฉ

### **ุฎุทุฃ: "Property role is undefined"**
**ุงูุญู:** ุชุฃูุฏ ูู ุฃู ุฌููุน ุงููุณุชุฎุฏููู ูุฏููู `role` ูู Firestore

### **ุฎุทุฃ: "Cannot read property 'participants'"**
**ุงูุญู:** ุชุฃูุฏ ูู ุฃู ุงูู chat document ููุฌูุฏ ููู `participants` array

---

**ุงูุขู: ุงุฐูุจ ุฅูู Firebase Console ูุทุจูู ุงูููุงุนุฏ! ๐**
