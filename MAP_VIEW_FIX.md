# ๐บ๏ธ ุฅุตูุงุญ ูุดููุฉ ุงุฎุชูุงุก ุงูุฎุฑูุทุฉ - Map View Fix

## ๐ **ุงููุดููุฉ:**

### **ุงููุตู:**
ุนูุฏ ุงูุชุจุฏูู ุจูู ุนุฑุถ ุงููุงุฆูุฉ (List) ูุนุฑุถ ุงูุฎุฑูุทุฉ (Map):
1. โ ุงูุฎุฑูุทุฉ ุชุธูุฑ ุจุดูู ุฌููู ูู ุงููุฑุฉ ุงูุฃููู
2. โ ุนูุฏ ุงูุนูุฏุฉ ูุนุฑุถ ุงููุงุฆูุฉ ุซู ุงูุฑุฌูุน ููุฎุฑูุทุฉุ ุงูุฎุฑูุทุฉ ุชุฎุชูู ููุง ุชุนูุฏ ููุธููุฑ

### **ุงูุณุจุจ:**
ูุดููุฉ ุดุงุฆุนุฉ ูุน ููุชุจุฉ Leaflet:
- ุนูุฏูุง ูุชู ุฅุฎูุงุก ุนูุตุฑ ุงูุฎุฑูุทุฉ (display: none ุฃู visibility: hidden)
- ุซู ุฅุธูุงุฑู ูุฑุฉ ุฃุฎุฑู
- ุชููุฏ ุงูุฎุฑูุทุฉ ูุนูููุงุช ุงูุญุฌู (dimensions)
- ุชุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุญุฌู ุจุงุณุชุฎุฏุงู `invalidateSize()`

---

## โ **ุงูุญู:**

### **ุงูุฅุตูุงุญ ุงููุทุจู:**

ุชู ุฅุถุงูุฉ `useEffect` ุฌุฏูุฏ ูุฑุงูุจ ุชุบููุฑ `viewMode` ููููู ุจู:

1. **ุงูุชุญูู ูู ูุถุน ุงูุฎุฑูุทุฉ:**
   - ูุชุฃูุฏ ุฃู `viewMode === 'map'`
   - ูุชุฃูุฏ ุฃู `mapInstance.current` ููุฌูุฏ

2. **ุชุญุฏูุซ ุญุฌู ุงูุฎุฑูุทุฉ:**
   - ูุณุชุฏุนู `mapInstance.current.invalidateSize()`
   - ูุฐุง ูุฌุจุฑ ุงูุฎุฑูุทุฉ ุนูู ุฅุนุงุฏุฉ ุญุณุงุจ ุญุฌููุง

3. **ุฅุนุงุฏุฉ ุถุจุท ุงูุนุฑุถ:**
   - ูุนูุฏ ุถุจุท ุงูุญุฏูุฏ (bounds) ูุชุดูู ุฌููุน ุงูุฏุนูุงุช
   - ูุดูู ูููุน ุงููุณุชุฎุฏู ุฅุฐุง ูุงู ูุชุงุญุงู
   - ูุชุฃูุฏ ูู ุฃู ุฌููุน ุงูููุงุท ูุฑุฆูุฉ

---

## ๐ง **ุงูููุฏ ุงููุถุงู:**

### **ุงูููู:** `src/pages/Home.jsx`

```javascript
// Fix for map disappearing when switching between list and map view
useEffect(() => {
    if (viewMode === 'map' && mapInstance.current) {
        // Small delay to ensure DOM is ready
        setTimeout(() => {
            if (mapInstance.current) {
                // โ ุชุญุฏูุซ ุญุฌู ุงูุฎุฑูุทุฉ
                mapInstance.current.invalidateSize();
                
                // โ ุฅุนุงุฏุฉ ุถุจุท ุงูุนุฑุถ
                if (invitationsWithCoords.length > 0 || userLocation) {
                    const bounds = [];
                    invitationsWithCoords.forEach(inv => {
                        if (inv.lat && inv.lng) bounds.push([inv.lat, inv.lng]);
                    });
                    if (userLocation) bounds.push([userLocation.lat, userLocation.lng]);
                    
                    if (bounds.length > 0) {
                        try {
                            mapInstance.current.fitBounds(bounds, {
                                padding: [50, 50],
                                maxZoom: 15,
                                animate: true
                            });
                        } catch (e) {
                            console.error("Error fitting bounds:", e);
                        }
                    }
                }
            }
        }, 100);
    }
}, [viewMode, invitationsWithCoords, userLocation]);
```

---

## ๐ก **ููู ูุนูู:**

### **1. ูุฑุงูุจุฉ ุงูุชุบููุฑุงุช:**
```javascript
}, [viewMode, invitationsWithCoords, userLocation]);
```
- ูุชูุงุนู ูุน ุชุบููุฑ `viewMode` ูู 'list' ุฅูู 'map'
- ูุชูุงุนู ูุน ุชุบููุฑ ุงูุฏุนูุงุช ุฃู ูููุน ุงููุณุชุฎุฏู

### **2. ุงูุชุฃุฎูุฑ ุงูุตุบูุฑ (100ms):**
```javascript
setTimeout(() => {
    // ...
}, 100);
```
- ูุนุทู ูุฑุตุฉ ููู DOM ูุชุญุฏูุซ ุงูุนุฑุถ
- ูุชุฃูุฏ ุฃู ุนูุตุฑ ุงูุฎุฑูุทุฉ ุฃุตุจุญ ูุฑุฆูุงู ุชูุงูุงู

### **3. invalidateSize():**
```javascript
mapInstance.current.invalidateSize();
```
- ูุฌุจุฑ Leaflet ุนูู ุฅุนุงุฏุฉ ุญุณุงุจ ุฃุจุนุงุฏ ุงูุฎุฑูุทุฉ
- **ูุฐุง ูู ุงูููุชุงุญ ุงูุฃุณุงุณู ููุญู!**

### **4. ุฅุนุงุฏุฉ ุถุจุท ุงูุนุฑุถ:**
```javascript
mapInstance.current.fitBounds(bounds, {
    padding: [50, 50],
    maxZoom: 15,
    animate: true
});
```
- ูุชุฃูุฏ ุฃู ุฌููุน ุงูููุงุท ูุฑุฆูุฉ
- ูุถูู padding ุญูู ุงูุญุฏูุฏ
- ูุถูู animation ุณูุณุฉ

---

## ๐ **Before vs After:**

### **โ ูุจู ุงูุฅุตูุงุญ:**

```
1. ูุชุญ Home โ ุนุฑุถ ุงููุงุฆูุฉ โ
2. ุงูุถุบุท ุนูู "Map" โ ุงูุฎุฑูุทุฉ ุชุธูุฑ โ
3. ุงูุถุบุท ุนูู "List" โ ุงููุงุฆูุฉ ุชุธูุฑ โ
4. ุงูุถุบุท ุนูู "Map" ูุฑุฉ ุฃุฎุฑู โ ุงูุฎุฑูุทุฉ ูุฎุชููุฉ! โ
```

**ุงููุดููุฉ:** ุงูุฎุฑูุทุฉ ูุง ุชุนูุฏ ููุธููุฑ

---

### **โ ุจุนุฏ ุงูุฅุตูุงุญ:**

```
1. ูุชุญ Home โ ุนุฑุถ ุงููุงุฆูุฉ โ
2. ุงูุถุบุท ุนูู "Map" โ ุงูุฎุฑูุทุฉ ุชุธูุฑ โ
3. ุงูุถุบุท ุนูู "List" โ ุงููุงุฆูุฉ ุชุธูุฑ โ
4. ุงูุถุบุท ุนูู "Map" ูุฑุฉ ุฃุฎุฑู โ ุงูุฎุฑูุทุฉ ุชุธูุฑ ุจุดูู ุตุญูุญ! โ
5. ูููู ุงูุชุจุฏูู ุจูู List ู Map ุจุฏูู ูุดุงูู โ
```

**ุงููุชูุฌุฉ:** ุงูุฎุฑูุทุฉ ุชุนูู ุจุดูู ูุซุงูู ูู ูู ูุฑุฉ!

---

## ๐ฏ **ุงูููุฒุงุช ุงูุฅุถุงููุฉ:**

### **1. Auto Re-centering:**
- ุนูุฏ ุงูุนูุฏุฉ ููุฎุฑูุทุฉุ ูุนูุฏ ุถุจุท ุงูุนุฑุถ ุชููุงุฆูุงู
- ูุชุฃูุฏ ุฃู ุฌููุน ุงูุฏุนูุงุช ูุฑุฆูุฉ

### **2. Smooth Animation:**
- ุงูุชุญุฑู ุณูุณ ูุฌููู
- ูุง ููุฌุฏ ููุฒุงุช ููุงุฌุฆุฉ

### **3. Error Handling:**
```javascript
try {
    mapInstance.current.fitBounds(bounds, {...});
} catch (e) {
    console.error("Error fitting bounds:", e);
}
```
- ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก ุงููุญุชููุฉ
- ูุง ูุชุนุทู ุงูุชุทุจูู ุญุชู ูู ุญุฏุซ ุฎุทุฃ

---

## ๐งช **ุงูุงุฎุชุจุงุฑ:**

### **ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ:**

#### **โ ุณููุงุฑูู 1: ุงูุชุจุฏูู ุงูุฃุณุงุณู**
1. ุงูุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
2. ุงุถุบุท ุนูู "Map View"
3. ุงุถุบุท ุนูู "List View"
4. ุงุถุบุท ุนูู "Map View" ูุฑุฉ ุฃุฎุฑู
5. **ุงููุชูุฌุฉ:** ุงูุฎุฑูุทุฉ ุชุธูุฑ ุจุดูู ุตุญูุญ โ

#### **โ ุณููุงุฑูู 2: ุงูุชุจุฏูู ุงููุชูุฑุฑ**
1. ุชุจุฏูู 5 ูุฑุงุช ุจูู List ู Map
2. **ุงููุชูุฌุฉ:** ุงูุฎุฑูุทุฉ ุชุนูู ูู ูู ูุฑุฉ โ

#### **โ ุณููุงุฑูู 3: ูุน ุชุบููุฑ ุงูููุงุชุฑ**
1. ุงูุชุญ Map View
2. ุบููุฑ ุงูููุชุฑ (ูุซูุงู: ุงุฎุชุฑ "Breakfast")
3. ุงุฐูุจ ูู List View
4. ุนุฏ ูู Map View
5. **ุงููุชูุฌุฉ:** ุงูุฎุฑูุทุฉ ุชุธูุฑ ูุน ุงูุฏุนูุงุช ุงููููุชุฑุฉ โ

#### **โ ุณููุงุฑูู 4: ูุน ุงูุจุญุซ**
1. ุงูุชุญ Map View
2. ุงุจุญุซ ุนู ุดูุก
3. ุงุฐูุจ ูู List View
4. ุนุฏ ูู Map View
5. **ุงููุชูุฌุฉ:** ุงูุฎุฑูุทุฉ ุชุธูุฑ ูุน ูุชุงุฆุฌ ุงูุจุญุซ โ

---

## ๐ **ุงููููุงุช ุงููุนุฏููุฉ:**

```
โ src/pages/Home.jsx
   - ุฅุถุงูุฉ useEffect ุฌุฏูุฏ (ุณุทุฑ 493-522)
   - ุญู ูุดููุฉ ุงุฎุชูุงุก ุงูุฎุฑูุทุฉ
```

---

## ๐ **ุงูุชูุงุตูู ุงูุชูููุฉ:**

### **ููุงุฐุง ุชุญุฏุซ ุงููุดููุฉุ**

ุนูุฏูุง ูุชู ุฅุฎูุงุก ุนูุตุฑ DOM:
```css
display: none;  /* ุฃู */
visibility: hidden;
```

ุงูู Leaflet map:
1. ุชููุฏ ุงูู dimensions (width, height)
2. ุชุนุชูุฏ ุฃู ุงูุญุฌู = 0x0 pixels
3. ูุง ุชุณุชุทูุน ุฑุณู ุงูู tiles ุจุดูู ุตุญูุญ

### **ุงูุญู:**

ุนูุฏ ุฅุธูุงุฑ ุงูุนูุตุฑ ูุฑุฉ ุฃุฎุฑู:
```javascript
mapInstance.current.invalidateSize();
```

ูุฐุง ูุฎุจุฑ Leaflet:
1. ุฃุนุฏ ุญุณุงุจ ุงูุญุฌู ูู ุฌุฏูุฏ
2. ุฃุนุฏ ุฑุณู ุงูู tiles
3. ุฃุนุฏ ูุถุน ุงูู markers ูู ุงูููุงู ุงูุตุญูุญ

---

## ๐ก **ูุตุงุฆุญ ูููุณุชูุจู:**

### **ุนูุฏ ุงูุนูู ูุน Leaflet:**

1. **ุฏุงุฆูุงู ุงุณุชุฎุฏู invalidateSize() ุนูุฏ:**
   - ุชุบููุฑ ุญุฌู ุงูู container
   - ุฅุธูุงุฑ/ุฅุฎูุงุก ุงูุฎุฑูุทุฉ
   - ุชุบููุฑ ูู ุงูู layout

2. **ุงุณุชุฎุฏู setTimeout ุตุบูุฑ:**
   - ูุนุทู ูุฑุตุฉ ููู DOM ููุชุญุฏูุซ
   - 100ms ูุงููุฉ ูู ูุนุธู ุงูุญุงูุงุช

3. **ุฑุงูุจ viewMode ูู useEffect:**
   - ุงุณุชุฎุฏู dependency array ุจุดูู ุตุญูุญ
   - ุชุฃูุฏ ูู ุชุดุบูู ุงูููุฏ ุนูุฏ ุงูุชุจุฏูู

---

## โ **ุงูุฎูุงุตุฉ:**

### **ุงููุดููุฉ:**
โ ุงูุฎุฑูุทุฉ ุชุฎุชูู ุนูุฏ ุงูุชุจุฏูู ูู List โ Map

### **ุงูุญู:**
โ ุฅุถุงูุฉ useEffect ูุณุชุฏุนู `invalidateSize()` ุนูุฏ ุชุบููุฑ viewMode

### **ุงููุชูุฌุฉ:**
โ ุงูุฎุฑูุทุฉ ุชุนูู ุจุดูู ูุซุงูู ูู ูู ูุฑุฉ
โ ูููู ุงูุชุจุฏูู ุจุฏูู ูุดุงูู
โ auto re-centering
โ smooth animations

---

**ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ! ๐**

ุงูุขู ุงูุฎุฑูุทุฉ ุชุนูู ุจุดูู ูุซุงูู ููู ุชุฎุชูู ูุฑุฉ ุฃุฎุฑู! ๐บ๏ธโจ
